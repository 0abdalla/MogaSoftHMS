<main id="item-order-limit-report" class="p-2">
    <h4>تقرير حد الطلب</h4>
    <form class="form p-2 row" [formGroup]="itemOrderLimitForm" (ngSubmit)="showReport()">
        <div class="col-lg-6">
            <div class="mb-2">
                <label class="form-label">اسم المخزن</label>
                <ng-select
                    [items]="stores"
                    bindLabel="name"
                    bindValue="id"
                    placeholder="اختر المخزن"
                    formControlName="StoreId"
                    class="text-end shadow-none w-100"
                    [searchable]="true">
                </ng-select>
                <div *ngIf="itemOrderLimitForm.get('StoreId')?.invalid && itemOrderLimitForm.get('StoreId')?.touched" class="text-danger">
                    اسم المخزن مطلوب
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-6">
                <button type="submit" class="btn-blue">تأكيد</button>
            </div>
            <div class="col-lg-6">
                <button type="reset" class="btn-red">إلغاء</button>
            </div>
        </div>
    </form>
</main>


<div class="modal fade" id="itemOrderLimit" tabindex="-1" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-xl">
      <div class="modal-content">
        
        <div id="printSection">
            <div class="modal-header">
                <h5 class="modal-title">
                  تقرير حد الطلب - مخزن {{ selectedStoreName }}
                </h5>
              </div>
        
              <div class="modal-body">
                <div *ngFor="let group of itemLimitData">
                  <h6 class="mt-3">المجموعة: {{ group.itemGroupName }}</h6>
                  
                  <table class="table table-bordered table-hover">
                    <thead class="table-primary">
                      <tr>
                        <th>رقم الصنف</th>
                        <th>اسم الصنف</th>
                        <th>حد الطلب</th>
                        <th>الرصيد</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr *ngFor="let item of group.items"
                          [ngClass]="{
                            'table-danger': item.balance < item.orderLimit,
                            'table-warning': item.balance === item.orderLimit
                          }">
                        <td>{{ item.itemId }}</td>
                        <td>{{ item.itemName }}</td>
                        <td>{{ item.orderLimit }}</td>
                        <td>{{ item.balance }}</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
                <div class="row text-start mt-4">
                  <div class="col-lg-4 mb-2">
                      إجمالي الأصناف :
                      <b>{{ reportSummary?.totalItems }} أصناف</b>
                  </div>
                  <div class="col-lg-4 mb-2 text-danger">
                      أقل من الحد :
                      <b>{{ reportSummary?.belowLimitCount }} أصناف</b>
                  </div>
                  <div class="col-lg-4 mb-2">
                      المجموعات المتأثرة :
                      <b>{{ reportSummary?.affectedGroups }} مجموعات</b>
                  </div>
                </div>
                <div class="row mt-4">
                    <hr>
                    <div class="col-md-6">
                        <strong>إسم المستخدم:</strong> {{ userName }}
                    </div>
                    <div class="col-md-6 text-end">
                        <strong>التاريخ:</strong> {{ today }}
                    </div>
                </div>
        
              </div>
        </div>
        <div class="text-center pb-2">
          <button class="btn-blue" (click)="printReport()">طباعة</button>
          <button type="button" class="btn-red mx-2" data-bs-dismiss="modal">خروج</button>
        </div>
      </div>
    </div>
  </div>
  