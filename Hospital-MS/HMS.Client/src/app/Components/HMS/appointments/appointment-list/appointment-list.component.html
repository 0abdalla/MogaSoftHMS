<main id="list-patients" @fadeIn>
  <div class="container-fluid">
    <div class="row mt-4">
      <div class="col-lg-2" *ngFor="let status of patientServices">
        <div class="card text-white p-3 text-center" [ngStyle]="{ 'background-image': status.color }">
          <h4>{{ status.name }}</h4>
          <p class="mt-0">{{ status.count }} ูุฑูุถ</p>
          <div class="percentage d-flex align-items-center justify-content-center gap-1">
            <p class="m-0"> 12%</p>
            <i class="fa-regular fa-circle-arrow-up"></i>
          </div>
          <!-- <img src="assets/vendors/imgs/Group 2.png" alt=""> -->
        </div>
      </div>
    </div>

    <div class="card mt-3 p-2">
      <div class="p-3 mt-4">
        <form [formGroup]="filterForm" (ngSubmit)="applyFilters()">
          <div class="row justify-content-between align-items-center gap-2">
            <div class="row col-8">
              <div class="col-lg-2">
                <button type="button" (click)="resetFilters()" class="btn-cancel ">ุฅุฒุงูุฉ ุงูููุชุฑุฉ</button>
              </div>
              <div class="col-lg-3">
                <select class="form-select shadow-none" formControlName="Type">
                  <option selected disabled value="">ุงุฎุชุฑ ููุน ุงูุญุฌุฒ</option>
                  <option value="General">ูุดู</option>
                  <option value="Consultation">ุงุณุชุดุงุฑุฉ</option>
                  <option value="Surgery">ุนูููุงุช</option>
                  <option value="Screening">ุชุญุงููู</option>
                  <option value="Radiology">ุฃุดุนุฉ</option>
                  <option value="Emergency">ุทูุงุฑุฆ</option>
                </select>
              </div>
              <div class="col-lg-6">
                <input
                  type="text"
                  class="form-control shadow-none"
                  placeholder="ุฃุฏุฎู ุฅุณู ุงููุฑูุถ ุฃู ุฑูู ุงููุงุชู"
                  formControlName="Search"
                />
              </div>
            </div>
            
            <div class="col-lg-2">
              <button type="submit" class="btn-purble">+ ุฅุถุงูุฉ ุญุฌุฒ</button>
            </div>
          </div>
        </form>
      </div>
  
      <table class="table table-hover mt-4">
        <thead>
          <tr>
            <th>ุงูุฅุณู</th>
            <th>ุงูุนูุงุฏุฉ ุงูุทุจูุฉ</th>
            <th>ุงูุฎุฏูุฉ ุงูุทุจูุฉ</th>
            <th>ุฑูู ุงูุญุฌุฒ</th>
          </tr>
        </thead>
        <tbody *ngIf="patients.length > 0">
          <tr
            *ngFor="let appointment of patients | paginate : { id: 'paginate', itemsPerPage: pageSize, currentPage: currentPage, totalItems: total }"
            (click)="openAppointmentModal(appointment.id)"
            data-bs-toggle="modal"
            data-bs-target="#bookingDetailsModal"
            style="cursor: pointer"
          >
            <td>
              <div class="d-flex align-items-center gap-2 justify-content-start">
                <div class="avatar-circle">{{ appointment.patientName.charAt(0) }}</div>
                <span class="fw-bold">{{ appointment.patientName }}</span>
              </div>
            </td>
            <td class="text-secondary fw-semibold">{{ appointment.clinicName || 'ุทูุงุฑุฆ' }}</td>
            <td>
              <p class="text-white status-pill fw-bold"
                *ngIf="appointment.type"
                [ngStyle]="{ backgroundColor: getServiceColor(appointment.type) }"
              >
                {{ getServiceName(appointment.type) }}
              </p>
            </td>
            <td class="text-secondary">{{ appointment.id }}</td>
          </tr>
        </tbody>
        <tbody *ngIf="patients.length === 0">
          <tr>
            <td colspan="5" class="text-center text-muted">ูุง ุชูุฌุฏ ุญุฌูุฒุงุช ุญุชู ุงูุงู</td>
          </tr>
        </tbody>
      </table>
  
      <div class="col-lg-12">
        <div
          *ngIf="total > 16"
          class="pagination-container my-0 px-3 d-flex justify-content-center align-items-center"
        >
          <div class="my-pagination">
            <pagination-controls
              id="paginate"
              (pageChange)="onPageChange($event)"
              (pageBoundsCorrection)="onPageChange($event)"
              [maxSize]="16"
              [directionLinks]="true"
              [autoHide]="true"
              [responsive]="true"
              previousLabel=""
              nextLabel=""
              screenReaderPageLabel="page"
              screenReaderCurrentLabel="You're on page"
            >
            </pagination-controls>
          </div>
        </div>
      </div>
    </div>
  </div>
</main>

  <div class="modal fade" id="bookingDetailsModal" tabindex="-1" aria-labelledby="bookingDetailsLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
      <div class="modal-content">
        <img src="assets/vendors/imgs/pattern.png" alt="" class="img-fluid">
        <div class="modal-header justify-content-center">
          <h5 class="modal-title" id="bookingDetailsLabel">ุชูุงุตูู ุงูุญุฌุฒ</h5>
        </div>

        <div id="pdfContent" class="modal-body p-4 print-section">

          <div class="row mb-3">
            <h4>
              ๐ค
              ุชูุงุตูู ุงููุฑูุถ</h4>
            <div class="col-lg-4">
              <strong class="strong">ุงุณู ุงููุฑูุถ:</strong> <span class="span"> {{ selectedAppointment?.patientName || '---' }}</span>
            </div>
            <div class="col-lg-4">
              <strong class="strong">ุงูุฑูู ุงูุทุจู:</strong> <span class="span"> {{ selectedAppointment?.patientId || '---' }}</span>
            </div>
            <div class="col-lg-4">
              <strong class="strong">ุฑูู ุงูุญุฌุฒ:</strong> <span class="span"> {{ selectedAppointment?.id || '---' }}</span>
            </div>
            <div class="col-lg-4">
              <strong class="strong">ุชุงุฑูุฎ ุงูุญุฌุฒ:</strong> <span class="span"> {{ selectedAppointment?.createdOn | date:'yyyy-MM-dd' }}</span>
            </div>
            <div class="col-lg-4">
              <strong class="strong">ุงูููุช:</strong> <span class="span"> {{ selectedAppointment?.createdOn | date:'hh:mm a' }}</span>
            </div>
            <div class="col-lg-4">
              <strong class="strong">ุงูุญุงูุฉ:</strong> <span class="span"> {{ selectedAppointment?.status }}</span>
            </div>
          </div>
          <hr>

          <h4 class="mb-3">
            ๐
            ุชูุงุตูู ุงูุญุฌุฒ</h4>
          <div class="row mb-3">
            <div class="col-lg-3" *ngIf="selectedAppointment?.type == 'Emergency'">
              <strong class="strong">ููุน ุงูุญุฌุฒ:</strong> <span class="span"> {{ selectedAppointment?.type || '---' }}</span>
            </div>
            <div *ngIf="selectedAppointment?.type !== 'Emergency'" class="row">
              <div class="col-lg-3">
                <strong class="strong">ููุน ุงูุญุฌุฒ:</strong> <span class="span"> {{ selectedAppointment?.type || '---' }}</span>
              </div>
              <div class="col-lg-3">
                <strong class="strong">ุงูุนูุงุฏุฉ:</strong> <span class="span"> {{ selectedAppointment?.clinicName || '---' }}</span>
              </div>
              <div class="col-lg-3">
                <strong class="strong">ุงูุทุจูุจ:</strong> <span class="span"> {{ selectedAppointment?.doctorName || '---' }}</span>
              </div>
              <div class="col-lg-3">
                <strong class="strong">ุทุฑููุฉ ุงูุญุฌุฒ:</strong> ุนุจุฑ ุงูุชุทุจูู   
              </div>
            </div>
          </div>

          <hr>

          <div class="row mb-3" *ngIf="selectedAppointment?.type === 'Emergency'">
            <h4 class="mb-3">
              ๐ฅ
              ุจูุงูุงุช ุงููุฑุงูู</h4>
            <div class="col-lg-4">
              <strong class="strong">ุงุณู ุงููุฑุงูู:</strong> <span class="span"> {{ selectedAppointment?.companionName || '---' }}</span>
            </div>
            <div class="col-lg-4">
              <strong class="strong">ุฑูู ุงููููุฉ:</strong> <span class="span"> {{ selectedAppointment?.companionNationalId || '---' }}</span>
            </div>
            <div class="col-lg-4">
              <strong class="strong">ุฑูู ุงููุงุชู:</strong> <span class="span"> {{ selectedAppointment?.companionPhone || '---' }}</span>
            </div>
            <hr class="mt-3">
          </div>

          <h4 class="mb-3">
            ๐ถ
            ุจูุงูุงุช ุงูุฏูุน</h4>
          <div class="row mb-3">
            <div class="col-lg-4">
              <strong class="strong">ุทุฑููุฉ ุงูุฏูุน:</strong> <span class="span"> {{ selectedAppointment?.paymentMethod || '---' }}</span>
            </div>
            <div class="col-lg-4">
              <strong class="strong">ูููุฉ ุงููุดู:</strong> <span class="span"> {{ selectedAppointment?.fee || '---' }} ุฌููู</span>
            </div>
            <div class="col-lg-4">
              <strong class="strong">ุชู ุงูุฏูุน:</strong> <span class="span"> {{ selectedAppointment?.isPaid ? 'ูุนู' : 'ูุง' }}</span>
            </div>
          </div>

          <hr>

          <h4 class="mb-3">
            ๐
            ููุงุญุธุงุช ุฅุถุงููุฉ</h4>
          <p class="text-muted"> <span class="span"> {{ selectedAppointment?.notes || 'ูุง ููุฌุฏ ููุงุญุธุงุช' }}</span></p>

        </div>

        <div class="modal-footer row">
          <div class="col-3 m-0">
            <button class="btn col-12 btn-outline-warning" data-bs-target="#updateEmergencyModal" data-bs-toggle="modal">ุชุญุฏูุซ ุงูุญุงูุฉ</button>
          </div>
          <div class="col-3 m-0">
            <button class="btn col-12 btn-outline-info" (click)="print()">ุทุจุงุนุฉ</button>
          </div>
          <div class="col-3 m-0">
            <button class="btn col-12 btn-outline-primary"(click)="exportToPDF()">ุชุญููู ุฅูู PDF</button>
          </div>
          <div class="col-3 m-0">
            <button class="btn col-12 btn-outline-warning">ุชุญููู ุฅูู ูุงุชูุฑุฉ</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="updateEmergencyModal" tabindex="-1" role="dialog" aria-labelledby="updateEmergencyModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-md modal-dialog-centered modal-dialog-scrollable" role="document">
      <div class="modal-content">
        <img src="assets/vendors/imgs/pattern.png" alt="" class="img-fluid">
        <div class="modal-header">
          <h5 class="modal-title" id="updateEmergencyModalLabel">ุชุญุฏูุซ ุงูุญุงูุฉ</h5>
        </div>
        <div class="modal-body">
          <form [formGroup]="updateEmergencyForm" (ngSubmit)="onSubmit()">
            <div class="form-group mb-3">
              <label class="form-label">ุงูุญุงูุฉ ุงูููุงุฆูุฉ</label>
              <select class="form-select shadow-none" formControlName="newStatus">
                <option selected disabled value="">ุงุฎุชุฑ ุงูุญุงูุฉ</option>
                <option value="CriticalCondition">ุชู ูููู ุฅูู ุงูุนูุงูุฉ ุงููุฑูุฒุฉ</option>
                <option value="Surgery">ุฏุฎู ุบุฑูุฉ ุงูุนูููุงุช</option>
                <!-- <option value="General">ุชู ุชุญูููู ุฅูู ูุดู</option> -->
                <option value="Treated">ุชู ุนูุงุฌู</option>
                <option value="Archived">ุชู ูููู ุฅูู ูุณุชุดูู ุฃุฎุฑู</option>
                <option value="Archived">ุฑูุถ ุงูุนูุงุฌ ูุฎุฑุฌ ุนูู ูุณุคูููุชู</option>
                <option value="Archived">ุชููู</option>
              </select>
            </div>

            <div class="form-group mb-3">
              <label class="form-label">ููุงุญุธุงุช</label>
              <textarea class="form-control shadow-none" formControlName="notes"></textarea>
            </div>

            <button type="submit" [disabled]="updateEmergencyForm.invalid" class="btn-blue">ุญูุธ ุงูุชุญุฏูุซ</button>
          </form>
        </div>
      </div>
    </div>
  </div>