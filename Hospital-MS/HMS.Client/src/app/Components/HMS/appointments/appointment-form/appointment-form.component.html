<main id="add-reservation" @fadeIn>
  <div class="container-fluid">
    <div class="card search-patient p-2 col-6 m-auto text-center">
      <h5 class="text-center">ุจุญุซ ุนู ูุฑูุถ ููุฌูุฏ</h5>
      <div class="col-6 m-auto mt-2">
        <div class="input-group">
          <input 
            type="search" 
            class="form-control shadow-none" 
            placeholder="ุงุจุญุซ ุจุฑูู ุงููุงุชู ูุชุนุจุฆุฉ ุงูุจูุงูุงุช ุชููุงุฆููุง .." 
            (input)="searchPatientByPhone($event)"
            maxlength="11"
          />
          <span class="input-group-text">
            <svg width="16" height="16" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16">
              <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.415l-3.85-3.85a1.007 1.007 0 0 0-.115-.098zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
            </svg>
          </span>
        </div>
      </div>
    </div>
    <form [formGroup]="reservationForm" class="form p-2" (ngSubmit)="onSubmit()">
      <p-toast position="top-left"></p-toast>
      <h4>๐คุจูุงูุงุช ุงููุฑูุถ</h4>
      <div class="row mb-3">
        <div class="col-lg-4">
          <label for="patientName" class="form-label">ุฅุณู ุงููุฑูุถ</label>
          <input type="text" id="patientName" class="form-control shadow-none" placeholder="ุฃุฏุฎู ุฅุณู ุงููุฑูุถ" formControlName="patientName">
          <div *ngIf="reservationForm.get('patientName')?.invalid && reservationForm.get('patientName')?.touched" class="text-danger">
            ุงุณู ุงููุฑูุถ ูุทููุจ
          </div>
        </div>
        
        <div class="col-lg-4">
          <label for="patientPhone" class="form-label">ุฑูู ุงููุงุชู </label>
          <input type="text" id="patientPhone" class="form-control shadow-none" placeholder="ุฃุฏุฎู ุฑูู ุงููุงุชู " formControlName="patientPhone">
          <div *ngIf="reservationForm.get('patientPhone')?.invalid && reservationForm.get('patientPhone')?.touched" class="text-danger">
            <ng-container *ngIf="reservationForm.get('patientPhone')?.errors?.['required']">ุฑูู ุงููุงุชู ูุทููุจ</ng-container>
            <ng-container *ngIf="reservationForm.get('patientPhone')?.errors?.['pattern']">ุฑูู ุงููุงุชู ุบูุฑ ุตุญูุญ</ng-container>
          </div>
        </div>
        <div class="col-lg-4">
          <label for="gender" class="form-label">ุงูููุน</label>
          <select id="gender" class="form-select shadow-none" formControlName="gender">
            <option selected disabled value="">ุงุฎุชุฑ ุงูููุน</option>
            <option value="Male">ุฐูุฑ</option>
            <option value="Female">ุงูุซู</option>
          </select>
          <div *ngIf="reservationForm.get('gender')?.invalid && reservationForm.get('gender')?.touched" class="text-danger">
            ุงูููุน ูุทููุจ
          </div>
        </div>
        

      </div>
      <hr>
      <h4>๐ฅุจูุงูุงุช ุงูุญุฌุฒ</h4>
      <div class="row mb-3">
        <div class="col-lg-3">
          <label for="app-date" class="form-label">ุชุงุฑูุฎ ุงูุญุฌุฒ</label>
          <input id="app-date" type="date" formControlName="appointmentDate" class="form-control shadow-none" (change)="onDayChange()">
          <div *ngIf="reservationForm.get('appointmentDate')?.invalid && reservationForm.get('appointmentDate')?.touched" class="text-danger">
            ุชุงุฑูุฎ ุงูุญุฌุฒ ูุทููุจ
          </div>
        </div>
        
        <div class="col-lg-3">
          <label for="clinic-type" class="form-label">ููุน ุงูุญุฌุฒ</label>
          <select id="clinic-type" class="form-select shadow-none" formControlName="appointmentType" 
                  (change)="onAppointmentTypeChange()">
            <option selected disabled value="">ุงุฎุชุฑ ููุน ุงูุญุฌุฒ</option>
            <option value="General">ูุดู</option>
            <option value="Consultation">ุงุณุชุดุงุฑุฉ</option>
            <option value="Surgery">ุนูููุงุช</option>
            <option value="Screening">ุชุญุงููู</option>
            <option value="Radiology">ุฃุดุนุฉ</option>
          </select>
          <div *ngIf="reservationForm.get('appointmentType')?.invalid && reservationForm.get('appointmentType')?.touched" class="text-danger">
            ููุน ุงูุญุฌุฒ ูุทููุจ
          </div>
        </div>
        
        <div class="col-lg-3">
          <label for="clinic" class="form-label">ุงูุฎุฏูุฉ ุงูุทุจูุฉ</label>
          <select id="clinic" class="form-select shadow-none" formControlName="medicalServiceId" 
                  (change)="onServiceSelected()">
            <option selected disabled value="">ุงุฎุชุฑ ุงูุฎุฏูุฉ</option>
            <option *ngFor="let service of filteredServices" [value]="service.id">
              {{ service.name }}
            </option>
            <option *ngIf="filteredServices.length === 0" disabled>
              {{ selectedDate ? 'ูุง ุชูุฌุฏ ุฎุฏูุงุช ูุชุงุญุฉ ูู ุงูููู ุงููุญุฏุฏ' : 'ูุง ุชูุฌุฏ ุฎุฏูุงุช ูุชุงุญุฉ ููููุน ุงููุญุฏุฏ' }}
            </option>
          </select>
          <div *ngIf="reservationForm.get('medicalServiceId')?.invalid && reservationForm.get('medicalServiceId')?.touched" class="text-danger">
            ุงูุฎุฏูุฉ ุงูุทุจูุฉ ูุทููุจุฉ
          </div>
        </div>
        
        <div class="col-lg-3" *ngIf="selectedAppointmentType !== 'Screening' && selectedAppointmentType !== 'Radiology'">
          <label for="clinic-doctor" class="form-label">ุงูุฏูุชูุฑ ุงููุฎุชุต</label>
          <select id="clinic-doctor" class="form-select shadow-none" formControlName="doctorId"
                  (change)="onDoctorSelected()">
            <option selected disabled value="">ุงุฎุชุฑ ุงูุฏูุชูุฑ ุงููุฎุชุต</option>
            <option *ngFor="let doctor of filteredDoctors" [value]="doctor.id">
              {{ doctor.fullName }}
            </option>
            <option *ngIf="filteredDoctors.length === 0" disabled>
              {{ selectedDate ? 'ูุง ููุฌุฏ ุฃุทุจุงุก ูุชุงุญูู ูู ุงูููู ุงููุญุฏุฏ' : 'ูุง ููุฌุฏ ุฃุทุจุงุก ูุชุงุญูู ููุฐู ุงูุฎุฏูุฉ' }}
            </option>
          </select>
        </div>

      </div>
      <div class="col-lg-12 text-center mt-3" *ngIf="showServicePrice">
        <h5>ุชูููุฉ ุงูุฎุฏูุฉ : <span>{{ selectedServicePrice !== null ? selectedServicePrice + ' ุฌููู' : 'ุบูุฑ ูุญุฏุฏ' }}</span></h5>
      </div>
            <hr>
            <h4>๐ุจูุงูุงุช ุฅุถุงููุฉ</h4>
            <div class="row mb-3">
                <div class="col-lg-4">
                    <label for="insuranceCompanyId" class="form-label">ุดุฑูุฉ ุงูุชุฃููู</label>
                    <select id="insuranceCompanyId" class="form-select shadow-none" formControlName="insuranceCompanyId">
            <option selected disabled value="">ุงุฎุชุฑ ุดุฑูุฉ ุงูุชุฃููู</option>
            <option *ngFor="let insuranceCompany of insuranceCompanies" [value]="insuranceCompany.id">{{ insuranceCompany.name }}</option>
          </select>
                </div>
                <div class="col-lg-4">
                  <label for="insuranceCategoryId" class="form-label">ูุฆุฉ ุงูุชุฃููู</label>
                  <select id="insuranceCategoryId" class="form-select shadow-none" formControlName="insuranceCategoryId">
                    <option selected disabled value="">ุงุฎุชุฑ ูุฆุฉ ุงูุชุฃููู</option>
                    <option *ngFor="let insuranceCategory of insuranceCategories" [value]="insuranceCategory.id">{{insuranceCategory.name}}</option>
                  </select>
                  <div *ngIf="reservationForm.get('insuranceCategoryId')?.invalid && reservationForm.get('insuranceCategoryId')?.touched" class="text-danger">
                    ูุฆุฉ ุงูุชุฃููู ูุทููุจุฉ
                  </div>
                </div>
                <div class="col-lg-4">
                    <label for="insuranceNumber" class="form-label">ุฑูู ุงูุชุฃููู</label>
                    <input type="text" id="insuranceNumber" class="form-control shadow-none" formControlName="insuranceNumber" placeholder="ุฃุฏุฎู ุฑูู ุงูุชุฃููู" pattern="[0-9]*">
                </div>

                <div class="col-lg-4 mt-3">
                    <label class="form-label">ุชู ุชุญููููุ</label>
                    <div class="form-check">
                        <input type="radio" id="referredYes" class="form-check-input shadow-none" formControlName="referred" value="yes">
                        <label for="referredYes" class="form-check-label">ูุนู</label>
                    </div>
                    <div class="form-check">
                        <input type="radio" id="referredNo" class="form-check-input shadow-none" formControlName="referred" value="no">
                        <label for="referredNo" class="form-check-label">ูุง</label>
                    </div>
                </div>
                <div class="col-lg-4 mt-3" *ngIf="reservationForm.get('referred')?.value === 'yes'">
                    <label for="referredClinic" class="form-label">ุงูุนูุงุฏุฉ ุงููุญูู ูููุง</label>
                    <select [disabled]="!reservationForm.get('referred')?.value" id="referredClinic" class="form-select shadow-none" formControlName="referredClinic">
            <option selected disabled value="">ุงุฎุชุฑ ุงูุนูุงุฏุฉ</option>
            <option value="ุนูุงุฏุฉ ุงูุนุธุงู">ุนูุงุฏุฉ ุงูุนุธุงู</option>
            <option value="ุนูุงุฏุฉ ุงูุจุงุทูุฉ">ุนูุงุฏุฉ ุงูุจุงุทูุฉ</option>
          </select>
                </div>
                <!-- <div class="col-lg-4 mt-3">
          <label class="form-label">ุญุงุตู ุนูู ุชุทุนููุ</label>
          <div class="form-check">
            <input type="radio" id="vaccinatedYes" class="form-check-input shadow-none" formControlName="vaccinated" value="yes">
            <label for="vaccinatedYes" class="form-check-label">ูุนู</label>
          </div>
          <div class="form-check">
            <input type="radio" id="vaccinatedNo" class="form-check-input shadow-none" formControlName="vaccinated" value="no">
            <label for="vaccinatedNo" class="form-check-label">ูุง</label>
          </div>
        </div> -->
                <div class="col-lg-4 mt-3">
                    <label for="paymentMethod" class="form-label">ูุณููุฉ ุงูุฏูุน</label>
                    <select id="paymentMethod" class="form-select shadow-none" formControlName="paymentMethod">
                    <option selected disabled value="">ุงุฎุชุฑ ูุณููุฉ ุงูุฏูุน</option>
                    <option value="ููุฏู">ููุฏู</option>
                    <option value="ุชุญููู ูุญุธู">ุชุญููู ูุญุธู</option>
          </select>
                </div>
            </div>
            <div class="row justify-content-center gap-2 px-3">
                <button type="submit" [disabled]="!reservationForm.valid" class="btn-blue col-2">ุฅุถุงูุฉ</button>
                <button type="reset" class="btn-outline-blue col-2">ุงูุบุงุก</button>

            </div>
    </form>
    </div>
</main>


<!-- <div *ngIf="showReceipt" class="receipt-container" id="receipt">
    <div class="receipt">
        <div class="receipt-header">
            <img src="assets/vendors/imgs/logo.png" alt="Company Logo" class="company-logo" />
            <h2>ุฅูุตุงู ุงูุญุฌุฒ</h2>
            <p>ูุณุชุดูู ุงูููุฑ ุงููุญูุฏู</p>
            <p>ุชุงุฑูุฎ ุงูุญุฌุฒ: {{ submittedData.appointmentDate | date: 'dd/MM/yyyy HH:mm' }}</p>
        </div>
        <hr />
        <div class="receipt-body">
            <h4>๐ค ุจูุงูุงุช ุงูุฒุงุฆุฑ</h4>
            <p><strong>ุงูุงุณู:</strong> {{ submittedData.patientName }}</p>
            <p><strong>ุฑูู ุงููุงุชู:</strong> {{ submittedData.patientPhone }}</p>

            <h4>๐ฅ ุจูุงูุงุช ุงูุญุฌุฒ</h4>
            <p><strong>ุชุงุฑูุฎ ุงูุญุฌุฒ:</strong> {{ submittedData.appointmentDate | date: 'dd/MM/yyyy HH:mm' }}</p>
            <p><strong>ููุน ุงูุญุฌุฒ:</strong> {{ submittedData.appointmentType }}</p>
            <p><strong>ุงูุฎุฏูุฉ ุงูุทุจูุฉ:</strong> {{ getClinicName(submittedData.medicalServiceId) }}</p>
            <p *ngIf="submittedData.appointmentType === 'Radiology'"><strong>ููุน ุงูุฃุดุนุฉ:</strong> {{ submittedData.radiologyType }}</p>
            <p *ngIf="submittedData.appointmentType !== 'Radiology' && submittedData.doctorId"><strong>ุงูุฏูุชูุฑ ุงููุฎุชุต:</strong> {{ getDoctorName(submittedData.doctorId) }}</p>

            <div *ngIf="submittedData?.insuranceCompanyId">
              <h4>๐ ุจูุงูุงุช ุฅุถุงููุฉ</h4>
              <p><strong>ุดุฑูุฉ ุงูุชุฃููู:</strong> {{ submittedData.insuranceCompanyId || 'ุบูุฑ ูุญุฏุฏ' }}</p>
              <p><strong>ูุฆุฉ ุงูุชุฃููู:</strong> {{ submittedData.insuranceCategoryId || 'ุบูุฑ ูุญุฏุฏ' }}</p>
              <p><strong>ุฑูู ุงูุชุฃููู:</strong> {{ submittedData.insuranceNumber || 'ุบูุฑ ูุญุฏุฏ' }}</p>
              <p><strong>ุชู ุชุญููููุ:</strong> {{ submittedData.referred === 'yes' ? 'ูุนู' : 'ูุง' }}</p>
              <p *ngIf="submittedData.referred === 'yes'"><strong>ุงูุนูุงุฏุฉ ุงููุญูู ูููุง:</strong> {{ submittedData.referredClinic }}</p>
              <p><strong>ูุณููุฉ ุงูุฏูุน:</strong> {{ submittedData.paymentMethod }}</p>
            </div>
        </div>
        <hr />
        <div class="receipt-footer">
            <p>ุดูุฑุงู ูุงุฎุชูุงุฑูู ุฎุฏูุงุชูุง</p>
            <p>ููุชูุงุตู: infinityclinic&#64;mogasoft.com | 0100 0201 499</p>
        </div>
    </div>
    <div class="receipt-actions">
        <button class="btn-blue" (click)="printReceipt()">ุทุจุงุนุฉ ุงูุฅูุตุงู</button>
        <button class="btn-outline-blue" (click)="closeReceipt()">ุฅุบูุงู</button>
    </div>
</div> -->

<app-print-invoice #PrintInvioce style="display: none;"></app-print-invoice>